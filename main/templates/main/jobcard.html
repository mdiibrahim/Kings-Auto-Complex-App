{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    />
    <style>
      .main {
        background-image: url("{% static 'sign.jpg' %}");
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
        height: 15vh; /* Adjust the height of the container as needed */
        width: 100%; /* Adjust the width of the container as needed */
        display: flex;
        justify-content: center;
        align-items: center;
      }
      /* Adjust layout for printing */
      @media print {
        .jumbotron {
          margin: 0%;
          padding: 0;
        }
        .alias-ninja {
          margin-bottom: 25rem;
        }
        .row {
          display: flex;
          flex-wrap: wrap;
        }

        .col-md-4 {
          flex: 0 0 33.33%;
          max-width: 33.33%;
        }
        body {
          display: flex;
          justify-content: center;
          align-items: center;
          margin: 0;
          padding: 0;
        }
        .main {
          background-image: url("{% static 'sign.jpg' %}");
          background-size: cover;
          background-repeat: no-repeat;
          background-position: center;
          height: 5vh;
          width: 100%;
          display: flex;
          justify-content: center;
          align-items: center;
          /* Additional print-specific styles for the container */
          /* Adjust as needed */
        }

        /* Allow text to wrap onto multiple lines */
        .col-md-6 {
          width: 50%;
          flex-basis: 50%;
        }

        /* Hide input boxes and only show text */
        input[type="text"] {
          display: none; /* Hide the input fields */
        }

        /* Hide delete button */
        .delete-row {
          display: none !important;
        }

        /* Hide navbar */
        .navbar {
          display: none;
        }

        /* Hide the footer */
        footer {
          display: none !important;
        }

        .submit-bt {
          display: none !important;
        }
      }
    </style>
  </head>
  <body>
    {% include 'main/navbar.html' %}
    <div
      class="jumbotron container justify-content-center"
      style="background-color: white; text-align: left"
    >
      <form id="dynamic-form" action="{% url 'create_jobcard' %}" method="POST">
        {% csrf_token %}
        <input type="hidden" name="date1" id="date1">
        <div
          class="container"
          style="border: 1px solid black; padding-top: 3%; padding-bottom: 3%"
        >
          <div
            style="border: 1px solid black; padding-top: 3%; padding-bottom: 3%"
            class="main"
          ></div>
          <div class="text-center mb-3">
            <h5><u>Jobcard</u></h5>
          </div>
          <div class="text-center mb-3">
            <h3><strong>Kings Auto Complex</strong></h3>
          </div>
          <div class="text-center mb-3" style="font-size: 0.75rem">
            (Beside Kolka CNG Pump, Shagorika, P.C Road, Chattogram.)
          </div>

          <div class="row" style="text-align: left">
            <div class="col-md-6">
              <div class="row">
                <div class="col-md-2">
                  <label for="Ref">Order No:</label>
                </div>
                <div class="col-md-8">
                  <input
                    type="number"
                    class="form-control"
                    id="order"
                    name="order"
                    value="{{ order_id }}"
                  />
                </div>
              </div>

              <div class="row">
                <div class="col-md-2">
                  <label for="date">Date:</label>
                </div>
                <div class="col-md-8">
                  <span id="date" name="date" style="font-size: 0.75rem">
                    
                    <!-- This span will hold today's date -->
                  </span>
                </div>
              </div>

              <div class="row">
                <div class="col-md-2">
                  <label for="name">Customer Name:</label>
                </div>
                <div class="col-md-8">
                  <input
                    type="text"
                    class="form-control"
                    id="name"
                    name="name"
                  />
                </div>
              </div>

              <div class="row">
                <div class="col-md-2">
                  <label for="address">Address:</label>
                </div>
                <div class="col-md-8">
                  <input
                    type="text"
                    class="form-control"
                    id="address"
                    name="address"
                  />
                </div>
              </div>

              <div class="row">
                <div class="col-md-2">
                  <label for="phone">Phone:</label>
                </div>
                <div class="col-md-8">
                  <input
                    type="text"
                    class="form-control"
                    id="phone"
                    name="phone"
                  />
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <!-- Second column content here -->
              <div class="row">
                <div class="col-md-4">
                  <label for="chassisNo">Chassis No:</label>
                </div>
                <div class="col-md-8">
                  <input
                    type="text"
                    class="form-control"
                    id="chassisNo"
                    name="chassisNo"
                  />
                </div>
              </div>

              <div class="row">
                <div class="col-md-4">
                  <label for="vehicleName">Vehicle Name:</label>
                </div>
                <div class="col-md-8">
                  <input
                    type="text"
                    class="form-control"
                    id="vehicleName"
                    name="vehicleName"
                  />
                </div>
              </div>

              <div class="row">
                <div class="col-md-4">
                  <label for="modelYear">Model Year:</label>
                </div>
                <div class="col-md-8">
                  <input
                    type="text"
                    class="form-control"
                    id="modelYear"
                    name="modelYear"
                  />
                </div>
              </div>

              <div class="row">
                <div class="col-md-4">
                  <label for="model">Model:</label>
                </div>
                <div class="col-md-8">
                  <input
                    type="text"
                    class="form-control"
                    id="model"
                    name="model"
                  />
                </div>
              </div>

              <div class="row">
                <div class="col-md-4">
                  <label for="engineNo">Engine No:</label>
                </div>
                <div class="col-md-8">
                  <input
                    type="text"
                    class="form-control"
                    id="engineNo"
                    name="engineNo"
                  />
                </div>
              </div>

              <div class="row">
                <div class="col-md-4">
                  <label for="vehicleReg">Vehicle Reg:</label>
                </div>
                <div class="col-md-8">
                  <input
                    type="text"
                    class="form-control"
                    id="vehicleReg"
                    name="vehicleReg"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        <div
          class="container"
          style="border: 1px solid black; padding-top: 3%; padding-bottom: 3%"
        >
          <!-- Table -->
          <table class="table mt-4 table-hover" style="width: 90%">
            <thead>
              <tr>
                <th scope="col">SL NO.</th>
                <th scope="col">Customer request as per own words</th>
                <th scope="col">Category</th>
                <th scope="col">Labor Charge</th>
                <th scope="col"></th>
                <!-- Empty column for delete button -->
              </tr>
            </thead>
            <tbody id="tableBody">
              <!-- Add table rows here -->
              <tr>
                <td>
                  <input
                    style="width: 100%; border: none"
                    type="text"
                    class="form-control"
                    id="slno_1"
                    name="slno_1"
                    value="1"
                  />
                </td>
                <td>
                  <input
                    style="width: 100%; border: none"
                    type="text"
                    class="form-control"
                    id="customerRequest_1"
                    name="customerRequest_1"
                  />
                </td>
                <td>
                  <input
                    style="width: 100%; border: none"
                    type="text"
                    class="form-control"
                    id="category_1"
                    name="category_1"
                  />
                </td>
                <td>
                  <input
                    style="width: 100%; border: none"
                    type="text"
                    class="form-control laborCharge"
                    id="laborCharge_1"
                    name="laborCharge_1"
                  />
                </td>
                <td>
                  <button type="button" class="btn btn-danger delete-row">
                    Delete
                  </button>
                </td>
              </tr>
              <!-- Add more rows as needed -->
            </tbody>
          </table>
          <!-- Total -->
          <div class="row mt-3">
            <div class="col-md-6">
              <div class="d-flex">
                <label style="margin-left: 100%">Total:</label>
                <input
                  style="margin-left: 30%; width: 100px; border: none"
                  type="number"
                  class="form-control"
                  id="totalAmount"
                  name="totalAmount"
                  value="Amount"
                />
              </div>
            </div>
          </div>
        </div>

        <div
          class="container"
          style="border: 1px solid black; padding-top: 3%; padding-bottom: 3%"
        >
          <!-- Additional Table -->
          <div class="row mt-5">
            <div class="col-md-12">
              <table class="table table-hover" style="width: 90%">
                <thead>
                  <tr>
                    <th scope="col">SL NO.</th>
                    <th scope="col">After Diagnosis and Inspection</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody id="diagnosisTableBody">
                  <tr>
                    <td>
                      <input
                        style="width: 100%; border: none"
                        type="text"
                        class="form-control"
                        id="dslno_1"
                        name="dslno_1"
                        value="1"
                      />
                    </td>
                    <td>
                      <input
                        style="width: 100%; border: none"
                        type="text"
                        class="form-control"
                        id="diagnosis_1"
                        name="diagnosis_1"
                      />
                    </td>
                    <td>
                      <button
                        type="button"
                        class="btn btn-danger delete-row delete-row-diagnosis"
                      >
                        Delete
                      </button>
                    </td>
                  </tr>
                  <!-- Add more rows as needed -->
                </tbody>
              </table>
            </div>
          </div>
          <!-- Diagnosis By and Driver's/Owner's Signature -->
          <div class="row alias-ninja">
            <div class="col-md-4 mt-5">
              <!-- Horizontal line above Reference By -->
              <hr
                style="
                  border: 0;
                  border-top: 2px solid #000;
                  margin-top: 5px;
                  margin-bottom: 5px;
                  width: 50%;
                "
              />
              <div class="form-group" style="margin-left: 38%">
                <label for="referenceBy">Reference By</label>
              </div>
            </div>
            <div class="col-md-4 mt-5">
              <!-- Horizontal line above Diagnosis By -->
              <hr
                style="
                  border: 0;
                  border-top: 2px solid #000;
                  margin-top: 5px;
                  margin-bottom: 5px;
                  width: 50%;
                "
              />
              <div class="form-group" style="margin-left: 38%">
                <label for="diagnosisBy">Diagnosis By</label>
              </div>
            </div>
            <div class="col-md-4 mt-5">
              <!-- Horizontal line above Driver's/Owner's Signature -->
              <hr
                style="
                  border: 0;
                  border-top: 2px solid #000;
                  margin-top: 5px;
                  margin-bottom: 5px;
                  width: 50%;
                "
              />
              <div class="form-group">
                <label for="signature" style="margin-left: 20%"
                  >Driver's/Owner's Signature</label
                >
              </div>
            </div>
          </div>
        </div>

        <div
          class="container"
          style="border: 1px solid black; padding-top: 3%; padding-bottom: 3%"
        >
          <!-- Additional Table -->
          <div class="row mt-5 page-break-before">
            <div class="col-md-12">
              <table class="table table-hover" style="width: 90%">
                <thead>
                  <tr>
                    <th scope="col" class="text-center" colspan="4">
                      Issue From Store
                    </th>
                    <th scope="col" class="text-center" colspan="4">
                      Demand From WorkShop
                    </th>
                  </tr>
                  <tr>
                    <th scope="col">SL NO.</th>
                    <th scope="col">Description of Materials</th>
                    <th scope="col">Quantity</th>
                    <th scope="col">Price</th>
                    <th scope="col">Description of Requisition Materials</th>
                    <th scope="col">Quantity</th>
                    <th scope="col">Signature</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody id="materialTableBody">
                  <tr>
                    <td>
                      <input
                        style="width: 100%; border: none"
                        type="text"
                        class="form-control"
                        id="mslno_1"
                        name="mslno_1"
                        value="1"
                      />
                    </td>
                    <td>
                      <input
                        style="width: 100%; border: none"
                        type="text"
                        class="form-control"
                        id="mat_des_1"
                        name="mat_des_1"
                      />
                    </td>
                    <td>
                      <input
                        style="width: 100%; border: none"
                        type="text"
                        class="form-control"
                        id="mat_qty_1"
                        name="mat_qty_1"
                      />
                    </td>
                    <td>
                      <input
                        style="width: 100%; border: none"
                        type="text"
                        class="form-control"
                        id="mat_price_1"
                        name="mat_price_1"
                      />
                    </td>
                    <td>
                      <input
                        style="width: 100%; border: none"
                        type="text"
                        class="form-control"
                        id="req_des_1"
                        name="req_des_1"
                      />
                    </td>
                    <td>
                      <input
                        style="width: 100%; border: none"
                        type="text"
                        class="form-control"
                        id="req_qty_1"
                        name="req_qty_1"
                      />
                    </td>
                    <td>
                      <input
                        style="width: 100%; border: none"
                        type="text"
                        class="form-control"
                        id="mat_sign_1"
                        name="mat_sign_1"
                      />
                    </td>
                    <td>
                      <button
                        type="button"
                        class="btn btn-danger delete-row delete-row-material"
                      >
                        Delete
                      </button>
                    </td>
                  </tr>
                  <!-- Add more rows as needed -->
                </tbody>
              </table>
            </div>
          </div>
          <div class="row">
            <div class="col-md-4">
              <div class="form-group">
                <label for="Ref">Engineer Name:</label>
                <input
                  type="text"
                  class="form-control"
                  id="engineerName"
                  name="engineerName"
                />
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-group">
                <label for="name">Technician Name:</label>
                <input
                  type="text"
                  class="form-control"
                  id="technicianname"
                  name="technicianname"
                />
              </div>
            </div>
            <div class="col-md-2 submit-bt">
              <button
                type="submit"
                class="btn btn-primary"
                style="margin-left: 83%; margin-top: 20%"
              >
                Submit
              </button>
            </div>
          </div>
        </div>
        <br />
      </form>
    </div>

    {% include 'main/footer.html' %}
    <!-- Your scripts -->
    <script>
      // Get today's date
      var today = new Date();

      // Get the day, month, and year
      var day = String(today.getDate()).padStart(2, "0");
      var month = String(today.getMonth() + 1).padStart(2, "0"); // January is 0!
      var year = today.getFullYear();

      // Format today's date as "dd/mm/yyyy"
      var formattedDate = year + "-" + month + "-" + day;

      // Display today's date in the span with id="date"
      document.getElementById("date").textContent = formattedDate;
      document.getElementById("date1").value = formattedDate;

      document.addEventListener("DOMContentLoaded", function () {
        // Get the table body element
        var tableBody = document.getElementById("tableBody");

        // Get the total amount input element
        var totalAmountInput = document.getElementById("totalAmount");

        // Function to generate a new row
        function generateRow(index) {
          // Create a new table row
          var newRow = document.createElement("tr");

          // Set the HTML content for the new row
          newRow.innerHTML = `
            <td>
              <input
                style="width: 100%; border: none"
                type="text"
                class="form-control"
                id="slno_${index}"
                name="slno_${index}"
                value="${index}"
              />
            </td>
            <td>
              <input
                style="width: 100%; border: none"
                type="text"
                class="form-control"
                id="customerRequest_${index}"
                name="customerRequest_${index}"
              />
            </td>
            <td>
              <input
                style="width: 100%; border: none"
                type="text"
                class="form-control"
                id="category_${index}"
                name="category_${index}"
              />
            </td>
            <td>
              <input
                style="width: 100%; border: none"
                type="text"
                class="form-control laborCharge"
                id="laborCharge_${index}"
                name="laborCharge_${index}"
              />
            </td>
            <td>
              <button type="button" class="btn btn-danger delete-row">
                Delete
              </button>
            </td>
          `;

          // Increment the total amount when the laborCharge input field value changes
          var laborChargeInput = newRow.querySelector(`#laborCharge_${index}`);
          laborChargeInput.addEventListener("input", updateTotalAmount);

          // Append the new row to the table body
          tableBody.appendChild(newRow);

          document.getElementById(`slno_${index}`).focus();
        }

        // Function to update the total amount
        function updateTotalAmount() {
          var totalAmount = 0;

          // Get all laborCharge input fields
          var laborChargeInputs = document.querySelectorAll(".laborCharge");

          // Calculate the total amount
          laborChargeInputs.forEach(function (input) {
            var laborChargeValue = parseFloat(input.value);
            if (!isNaN(laborChargeValue)) {
              totalAmount += laborChargeValue;
            }
          });

          // Update the total amount input field value
          totalAmountInput.value = totalAmount.toFixed(2);
        }

        // Attach input event listener to the document for laborCharge input fields
        document.addEventListener("input", function (event) {
          if (event.target.classList.contains("laborCharge")) {
            // Call the updateTotalAmount function
            updateTotalAmount();
          }
        });

        // Function to handle key press events
        function handleKeyPress(event) {
          // Check if Enter key is pressed
          if (event.key === "Enter") {
            event.preventDefault();
            // Get the target element
            var target = event.target;

            // Check if the target is a laborCharge input field
            if (target.classList.contains("laborCharge")) {
              // Generate a new row with an incremented index
              var currentRow = target.parentElement.parentElement;
              var currentIndex = parseInt(
                currentRow.querySelector('input[name^="slno_"]').value
              );

              var newIndex = currentIndex + 1;
              generateRow(newIndex);
            } else if (
              target.classList.contains("form-control") &&
              target.id.startsWith("diagnosis_")
            ) {
              // Get the current row
              var currentRow = target.parentElement.parentElement;
              var diagnosisTableBody =
                document.getElementById("diagnosisTableBody");

              // Check if the current row is the last row
              if (currentRow === diagnosisTableBody.lastElementChild) {
                // Generate a new row with an incremented index
                var currentIndex = parseInt(
                  currentRow.querySelector('input[name^="dslno_"]').value
                );
                var newIndex = currentIndex + 1;
                generateDiagnosisRow(newIndex);
              }
            } else if (
              target.classList.contains("form-control") &&
              target.id.startsWith("mat_sign_")
            ) {
              // Get the current row
              var currentRow = target.parentElement.parentElement;
              var materialTableBody =
                document.getElementById("materialTableBody");

              // Check if the current row is the last row
              if (currentRow === materialTableBody.lastElementChild) {
                // Generate a new row with an incremented index
                var currentIndex = parseInt(
                  currentRow.querySelector('input[name^="mslno_"]').value
                );
                var newIndex = currentIndex + 1;
                generateMaterialRow(newIndex);
              }
            }
          }
        }

        // Attach event listener to the document for keydown events
        document.addEventListener("keydown", handleKeyPress);

        // Attach event listener to the delete buttons
        tableBody.addEventListener("click", function (event) {
          if (event.target.classList.contains("delete-row")) {
            // Get the current row
            var currentRow = event.target.parentElement.parentElement;

            // Remove the current row
            currentRow.remove();

            // Update the total amount
            updateTotalAmount();
          }
        });

        // Get the diagnosis table body element
        var diagnosisTableBody = document.getElementById("diagnosisTableBody");

        // Function to generate a new row
        function generateDiagnosisRow(index) {
          // Create a new table row
          var newRow = document.createElement("tr");

          // Set the HTML content for the new row
          newRow.innerHTML = `
    <td>
      <input
        style="width: 100%; border: none"
        type="text"
        class="form-control"
        id="dslno_${index}"
        name="dslno_${index}"
        value="${index}"
      />
    </td>
    <td>
      <input
        style="width: 100%; border: none"
        type="text"
        class="form-control"
        id="diagnosis_${index}"
        name="diagnosis_${index}"
      />
    </td>
    <td>
      <button
        type="button"
        class="btn btn-danger delete-row delete-row-diagnosis"
      >
        Delete
      </button>
    </td>
  `;

          // Append the new row to the diagnosis table body
          diagnosisTableBody.appendChild(newRow);

          document.getElementById(`dslno_${index}`).focus();
        }

        // Function to handle deletion of a row
        function handleDiagnosisRowDeletion(event) {
          var row = event.target.closest("tr");
          if (row) {
            row.remove();
          }
        }

        // Attach click event listener to the "Delete" buttons
        diagnosisTableBody.addEventListener("click", function (event) {
          if (event.target.classList.contains("delete-row-diagnosis")) {
            handleDiagnosisRowDeletion(event);
          }
        });

        // Get the material table body element
        var materialTableBody = document.getElementById("materialTableBody");

        // Function to generate a new row for materials
        function generateMaterialRow(index) {
          // Create a new table row
          var newRow = document.createElement("tr");

          // Set the HTML content for the new row
          newRow.innerHTML = `
    <td>
      <input
        style="width: 100%; border: none"
        type="text"
        class="form-control"
        id="mslno_${index}"
        name="mslno_${index}"
        value="${index}"
      />
    </td>
    <td>
      <input
        style="width: 100%; border: none"
        type="text"
        class="form-control"
        id="mat_des_${index}"
        name="mat_des_${index}"
      />
    </td>
    <td>
      <input
        style="width: 100%; border: none"
        type="text"
        class="form-control"
        id="mat_qty_${index}"
        name="mat_qty_${index}"
      />
    </td>
    <td>
      <input
        style="width: 100%; border: none"
        type="text"
        class="form-control"
        id="mat_price_${index}"
        name="mat_price_${index}"
      />
    </td>
    <td>
      <input
        style="width: 100%; border: none"
        type="text"
        class="form-control"
        id="req_des_${index}"
        name="req_des_${index}"
      />
    </td>
    <td>
      <input
        style="width: 100%; border: none"
        type="text"
        class="form-control"
        id="req_qty_${index}"
        name="req_qty_${index}"
      />
    </td>
    <td>
      <input
        style="width: 100%; border: none"
        type="text"
        class="form-control"
        id="mat_sign_${index}"
        name="mat_sign_${index}"
      />
    </td>
    <td>
      <button
        type="button"
        class="btn btn-danger delete-row delete-row-material"
      >
        Delete
      </button>
    </td>
  `;

          // Append the new row to the material table body
          materialTableBody.appendChild(newRow);

          // Set focus on next row
          document.getElementById(`mslno_${index}`).focus();
        }

        // Function to handle deletion of a material row
        function handleMaterialRowDeletion(event) {
          var row = event.target.closest("tr");
          if (row) {
            row.remove();
          }
        }

        // Attach click event listener to the "Delete" buttons in the material table
        materialTableBody.addEventListener("click", function (event) {
          if (event.target.classList.contains("delete-row-material")) {
            handleMaterialRowDeletion(event);
          }
        });
      });
    </script>
  </body>
</html>
