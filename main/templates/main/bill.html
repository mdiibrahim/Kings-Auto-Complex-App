{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Create Bill</title>
    <!-- Include Bootstrap 5 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" />

    <style>
      :root {
        --primary-color: #eab11a;
        --secondary-color: #f9d448;
        --third-color: #f2f2f2;
        --background-color: #000000;
      }

      /* Body styling with car background image */
      body {
        background: url('{% static "car_image.jpg" %}') no-repeat center center fixed;
        background-size: cover; /* Ensure the image covers the entire background */
      }

      /* Container for the main content */
      .container {
        background-color: rgba(255, 255, 255, 0.8); /* Make background a little transparent */
        padding: 60px;
        border-radius: 10px;
        margin-top: 100px; /* Add some top margin */
        margin-bottom: 100px; /* Add some bottom margin */
        max-width: 75% !important;
        margin-left: auto; /* Center horizontally */
        margin-right: auto; /* Center horizontally */
      }

      .btn-login {
        background-color: var(--primary-color) !important; /* Primary color as default */
        color: #000;
        font-weight: 700;
        border-radius: 50px;
        padding: 15px;
        transition: background-color 0.3s, transform 0.3s ease;
      }

      .btn-login:hover {
        background-color: var(--secondary-color) !important; /* Secondary color on hover */
        transform: scale(1.05);
      }
      .main {
        background-image: url("{% static 'sign.jpg' %}");
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
        height: 15vh; /* Adjust the height of the container as needed */
        width: 100%; /* Adjust the width of the container as needed */
        display: flex;
        justify-content: center;
        align-items: center;
      }

        .table th, .table td {

  padding: 10px;
}
.table th{
        background-color: var(--primary-color) !important;
        }
        /* Adjust layout for printing */
      @media print {
        .container {
          margin: 0%;
          padding: 0;
        }
        .alias-ninja {
          margin-bottom: 25rem;
        }
        .row {
          display: flex;
          flex-wrap: wrap;
        }
    </style>
  </head>
  <body>
    {% include 'main/navbar.html' %}

    <div
      class=" container justify-content-center"
    >
      <div
        class=""
        style="border: 1px solid black;  "
      >
        <div
          class="main "
        ></div>
        <div class="text-center my-2">
          <h6><u>ESTIMATE / QUOTATION</u></h6>
        </div>
        <div class="text-center mb-1">
            <h3><strong>Kings Auto Complex</strong></h3>
          </div>
          <div class="text-center mb-4" style="font-size: 0.75rem">
            (Beside Kolka CNG Pump, Shagorika, P.C Road, Chattogram.)
          </div>

        <div class="row p-3 my-3" style="text-align: left">
          <div class="col-md-6">
            <div class="row mb-2">
              <div class="col-md-4">
                <label for="Ref">Ref:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="ref" />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-4">
                <label for="date">Date:</label>
              </div>
              <div class="col-md-8">
                <span id="date" style="font-size: 0.75rem"></span>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-4">
                <label for="estimateNo">Estimate No:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="estimateNo" />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-4">
                <label for="name">Name:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="name" />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-4">
                <label for="address">Address:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="address" />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-4">
                <label for="phone">Phone:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="phone" />
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="row mb-2">
              <div class="col-md-4">
                <label for="chassisNo">Chassis No:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="chassisNo" />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-4">
                <label for="vehicleName">Vehicle Name:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="vehicleName" />
              </div>
            </div>

          <div class="row mb-2">
              <div class="col-md-4">
                <label for="modelYear">Model Year:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="modelYear" />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-4">
                <label for="model">Model:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="model" />
              </div>
            </div>

             <div class="row mb-2">
              <div class="col-md-4">
                <label for="engineNo">Engine No:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="engineNo" />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-4">
                <label for="vehicleReg">Vehicle Reg:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="vehicleReg" />
              </div>
            </div>
          </div>
        </div>
      </div>

      <div
        class="my-3"
        style="border: 1px solid black; "
      >
        <!-- Table -->
        <table id="estimate-table" class="table mt-4 table-hover" style="width:100%;">
          <colgroup>
            <col style="width:8%;">   <!-- SL NO. -->
            <col style="width:48%;">  <!-- Description -->
            <col style="width:12%;">  <!-- Service -->
            <col style="width:12%;">  <!-- Qty -->
            <col style="width:15%;">  <!-- Taka -->
            <col style="width:5%;">   <!-- Delete btn -->
          </colgroup>
          <thead>
            <tr>
              <th scope="col">SL NO.</th>
              <th scope="col">Description</th>
              <th scope="col">Service</th>
              <th scope="col">Qty</th>
              <th scope="col">Taka</th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody>
            <!-- One sample row -->
            <tr>
              <td>
                <input
                  type="number"
                  class="form-control"
                  value="1"
                />
              </td>
              <td>
                <textarea
                  class="form-control"
                  rows="1"
                  placeholder="Enter service/parts description..."
                >Description</textarea>
              </td>
              <td>
                <input
                  type="number"
                  class="form-control"
                  value="0.00"
                />
              </td>
              <td>
                <input
                  type="number"
                  class="form-control"
                  value="0"
                />
              </td>
              <td>
                <input
                  type="number"
                  class="form-control"
                  value="0.00"
                />
              </td>
              <td>
                <button type="button" class="btn btn-danger delete-row">Delete</button>
              </td>
            </tr>
          </tbody>
        </table>

        <div style="display:flex; gap:24px; align-items:center; flex-wrap:wrap;">
          <h6 style="margin-left: 13%; font-size: 0.75rem">Total (VAT not included)</h6>
          <h6 style="font-size: 0.75rem"></h6>  <!-- service total -->
          <h6 style="font-size: 0.75rem"></h6>  <!-- (unused placeholder to keep layout) -->
          <h6 style="font-size: 0.75rem"></h6>  <!-- amount total -->
        </div>
      </div>

      <div
        class=""
        style="border: 1px solid black; padding-top: 3%; padding-bottom: 3%; width: 100%;"
      >
        <div class="row p-3 my-3" style="text-align: left">
          <div class="col-md-6">
            <div class="row mb-2">
              <div class="col-md-4">
                <label for="engineerName">Engineer Name:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="engineerName" />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-4">
                <label for="serviceAdvisor">Service Advisor:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="serviceAdvisor" />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-4">
                <label for="mobileNo">Mobile No:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="mobileNo" />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-4">
                <label for="estimateCreatedBy">Estimate Created by:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="estimateCreatedBy" />
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="row mb-2">
              <div class="col-md-4">
                <label for="technician">Technician:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="technician" />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-4">
                <label for="refJobNo">Ref.Job No:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="refJobNo" />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-4">
                <label for="refEstNo">Ref.Est.#:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="refEstNo" />
              </div>
            </div>

           <div class="row mb-2">
              <div class="col-md-4">
                <label for="mileage">Mileage(KM):</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="mileage" />
              </div>
            </div>

            <div class="row mt-5">
              <div class="col-md-4">
                <label for="remarks">Remarks:</label>
              </div>
              <div class="col-md-8">
                <input type="text" class="form-control" id="remarks" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    {% include 'main/footer.html' %}
 <!-- Bootstrap 5 JS (No jQuery required) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Today's date
      (function setToday() {
        var today = new Date();
        var day = String(today.getDate()).padStart(2, "0");
        var month = String(today.getMonth() + 1).padStart(2, "0");
        var year = today.getFullYear();
        document.getElementById("date").textContent = day + "/" + month + "/" + year;
      })();

      document.addEventListener("DOMContentLoaded", function () {
        var table = document.getElementById("estimate-table");

        // Auto-grow textareas
        function autoGrow(el) {
          el.style.height = "auto";
          el.style.height = el.scrollHeight + "px";
        }
        table.addEventListener("input", function (e) {
          if (e.target && e.target.matches("textarea")) {
            autoGrow(e.target);
          }
        });
        // Initialize any existing textareas
        table.querySelectorAll("textarea").forEach(autoGrow);

        // Add new row on Enter in the second-last editable column (Taka)
        table.addEventListener("keydown", function (event) {
          if (
            event.key === "Enter" &&
            (event.target.matches("input") || event.target.matches("textarea"))
          ) {
            var currentRow = event.target.closest("tr");
            // second last editable column is Taka (index 4)
            var isOnTaka =
              event.target ===
              currentRow.children[4].querySelector("input");

            if (isOnTaka) {
              var newRow = currentRow.cloneNode(true);

              // Clear inputs and textareas in the new row
              newRow.querySelectorAll("input, textarea").forEach(function (el, idx) {
                if (el.type === "number") el.value = "";
                else el.value = "";
                if (el.tagName.toLowerCase() === "textarea") autoGrow(el);
              });

              // Increment SL NO. automatically
              var tbody = table.querySelector("tbody");
              var newIndex = tbody.querySelectorAll("tr").length + 1;
              newRow.children[0].querySelector("input").value = newIndex;

              tbody.appendChild(newRow);

              // Focus first field of the new row
              var firstInput = newRow.querySelector("input, textarea");
              if (firstInput) firstInput.focus();

              updateTotal();
            }
          }
        });

        // Delete row buttons
        table.addEventListener("click", function (event) {
          if (event.target.classList.contains("delete-row")) {
            var currentRow = event.target.closest("tr");
            currentRow.remove();
            // Re-number SL NO.
            table.querySelectorAll("tbody tr").forEach(function (tr, i) {
              var sl = tr.children[0].querySelector("input");
              if (sl) sl.value = i + 1;
            });
            updateTotal();
          }
        });

        // Sum totals (Service + Taka)
        function updateTotal() {
          var rows = table.querySelectorAll("tbody tr");
          var amt_total = 0;
          var serv_total = 0;

          rows.forEach(function (row) {
            // Service column = index 2
            var serviceCell = row.children[2];
            var sInput = serviceCell ? serviceCell.querySelector("input") : null;
            var sVal = sInput ? parseFloat((sInput.value || "").trim()) : NaN;
            if (!isNaN(sVal)) serv_total += sVal;

            // Taka column = index 4
            var takaCell = row.children[4];
            var tInput = takaCell ? takaCell.querySelector("input") : null;
            var tVal = tInput ? parseFloat((tInput.value || "").trim()) : NaN;
            if (!isNaN(tVal)) amt_total += tVal;
          });

          // Update the values in the adjacent h6 elements (service total & amount total)
          var containers = document.querySelectorAll(".container");
          var totalsContainer = containers[containers.length - 2]; // the totals block container
          if (totalsContainer) {
            var h6s = totalsContainer.querySelectorAll("h6");
            if (h6s[1]) h6s[1].textContent = serv_total.toFixed(2);
            if (h6s[3]) h6s[3].textContent = amt_total.toFixed(2);
          }
        }

        // Recalc on any input changes
        table.addEventListener("input", function (e) {
          if (e.target.matches("input")) {
            updateTotal();
          }
        });

        // Initial calc
        updateTotal();
      });
    </script>
  </body>
</html>
